<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.smhrd.database.NutritionfactsMapper">
    <select id="selectNutriByName" parameterType="java.lang.String" resultType="com.smhrd.domain.NutritionfactsVO">
        SELECT * FROM nutritionfacts_info WHERE food_name LIKE #{foodName}
    </select>
   
    <insert id="insertMyNutritionFactInfo" parameterType="map" >
 		<foreach collection="nutriidxArray" item="item">
        INSERT INTO MY_NUTRITIONFACT_INFO (MN_IDX, NUTRI_IDX, USER_ID, CREATED_AT)
        VALUES (MY_NUTRITIONFACT_INFO_SEQ.NEXTVAL, #{item}, #{user_id}, sysdate)
 		</foreach>   	
    </insert>
    
    <delete id="deleteMyNutritionFact" parameterType="int">
    	delete from MY_NUTRITIONFACT_INFO where NUTRI_IDX=#{nutri_idx}
    </delete>
    
	<select id="selectUserNutritionFacts" parameterType="java.util.Map" resultType="com.smhrd.domain.MyNutritionfactsVO">
	    SELECT M.MN_IDX, M.NUTRI_IDX, M.USER_ID, M.CREATED_AT, N.CALORIES
	    FROM MY_NUTRITIONFACT_INFO M
	    JOIN NUTRITIONFACTS_INFO N ON M.NUTRI_IDX = N.NUTRI_IDX
	    WHERE M.CREATED_AT >= TO_CHAR(SYSDATE-7,'YYYYMMDD') AND M.USER_ID = #{user_id}
	</select>
	
	<select id="MonhtselectUserNutritionFacts" parameterType="java.util.Map" resultType="com.smhrd.domain.MyNutritionfactsVO">
	    SELECT M.MN_IDX, M.NUTRI_IDX, M.USER_ID, M.CREATED_AT, N.CALORIES
	    FROM MY_NUTRITIONFACT_INFO M
	    JOIN NUTRITIONFACTS_INFO N ON M.NUTRI_IDX = N.NUTRI_IDX
	    WHERE M.CREATED_AT >= TO_CHAR(SYSDATE-30,'YYYYMMDD') AND M.USER_ID = #{user_id}
	</select>
    
</mapper>
