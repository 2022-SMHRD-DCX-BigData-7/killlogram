!function(n){n.Oven=n.Oven||{}}(this);$(function(){var e=function(e){_.extend(this,e);var o={"You have the unsaved data in this page. Do you want to restore it?":{ko:"이 페이지에 저장되지 않은 임시데이터가 있습니다. 불러오시겠습니까?"},"Not enough free space. You need to upgrade the account.":{ko:"이미지 저장공간이 가득찼습니다. 계정 업그레이드가 필요합니다."},"Verify your email and get a free upgrade to Standard account now.":{ko:"이메일 인증을 받게 되면 Standard 계정으로 무료 업그레이드 할 수 있습니다."},"You can upload JPG, PNG or GIF files only.":{ko:"JPG, PNG 또는 GIF 파일만 업로드할 수 있습니다"},"Maximum filesize is limited to ":{ko:"이미지 용량이 너무 큽니다.\n이미지파일 당 최대 사이즈 : "},"Multiple image uploading is available up to 10 files.\n Please try again.":{ko:"한번에 동시 업로드할 수 있는 최대 개수는 10개입니다.\n다시 선택해주세요."},"Are you sure to delete?":{ko:"정말로 삭제하시겠습니까?"},"(You cannot recover the removed pages.)":{ko:"(삭제된 페이지는 복원할 수 없습니다.)"},"Are you sure to delete this image?\n(If you used this image on pages, it'll be displayed as a wireframe.)":{ko:"이 이미지를 삭제하시겠습니까?\n(기존에 이 이미지를 페이지에 사용했다면, 해당 이미지 영역은 와이어프레임으로 대체됩니다.)"},"Are you sure to delete these images?\n(If you used thees images on pages, they'll be displayed as wireframes.)":{ko:"이 이미지들을 삭제하시겠습니까?\n(기존에 이 이미지들을 페이지에 사용했다면, 해당 이미지 영역은 와이어프레임으로 대체됩니다.)"},"Drag tabs to change the order":{ko:"드래그하여 순서를 변경할 수 있습니다"},"Right-click to show menu":{ko:"우클릭하여 메뉴 표시"},"You don't have the permission. Please login again.":{ko:"권한이 없습니다. 다시 로그인해주세요"},"Cannot save the page due to error.":{ko:"오류로 인해 저장할 수 없습니다. 다시 시도해주세요."},"Cannot perform action due to an error.":{ko:"오류로 인해 수행할 수 없습니다. 다시 시도해주세요."},"You have unsaved page.":{ko:"변경사항이 저장되지 않은 페이지가 있습니다."},"Sending..":{ko:"전송 중.."},Send:{ko:"보내기"},"Processing..":{ko:"처리 중.."},"Crop and upload":{ko:"선택한 영역으로 새 이미지 등록"},"The filtered filesize is too big to upload.":{ko:"결과물의 파일크기로 인해 업로드할 수 없습니다."},"Filter and upload":{ko:"효과 적용하여 새 이미지 등록"},"URL is invalid.":{ko:"올바른 URL을 입력해주세요"},"Email address is invalid.":{ko:"적합한 이메일주소를 입력해주세요."},"Already exists in the list.":{ko:"공유목록에 존재하는 유저입니다."},"You cannot add yourself.":{ko:"유저 자신은 추가할 수 없습니다."},"Delete selected items?":{ko:"선택된 항목을 삭제할까요?"},"Delete this item?":{ko:"이 항목을 삭제할까요?"},Delete:{ko:"삭제하기"},Cancel:{ko:"취소"},"Same with the currently verified address.":{ko:"현재의 인증된 이메일 주소와 동일합니다."},"We've sent a verification mail. Please check your spam folder if the email doesn’t appear within a few minutes.":{ko:"인증메일이 전송되었습니다. 이메일이 몇 분 이내에 나타나지 않을 경우 스팸 폴더를 확인하시기 바랍니다."},"Email address is already taken.":{ko:"이미 누군가 사용중인 이메일주소입니다"},"Verification canceled.":{ko:"인증 진행이 취소되었습니다."},"Your username is changed.":{ko:"유저이름이 변경되었습니다."},"Password doesn't match<br>the confirmation.":{ko:"앞서 입력한 비밀번호와 다릅니다.<br>확인해주세요."},"Your password is changed.":{ko:"비밀번호가 변경되었습니다."},"Incorrect password.":{ko:"기존의 비밀번호를 잘못 입력하셨습니다."},"Upload size limited to 1MB.":{ko:"1MB 이하의 파일만 첨부할 수 있습니다."},"Thank you for contacting us. We will use your reports as we strive to improve your usability.":{ko:"귀중한 시간을 내주셔서 정말 감사합니다. 보내주신 내용은 잊지않고 반드시 검토 후 확인해보도록 하겠습니다."},"Are you sure?":{ko:"계속 진행할까요?"},"All of your data and the account has been deleted.\nWe'll miss you. Goodbye.":{ko:"계정정보와 데이터가 모두 삭제되었습니다.\n그동안 감사했습니다."},"Incorrect email address or password.":{ko:"입력하신 계정 정보가 맞지 않습니다."},"DoubleClick or drag into canvas to insert":{ko:"더블클릭하거나 캔버스로 드래그하여 삽입"},"This page has been modified but not saved. Do you wish to continue?":{ko:"이 페이지의 수정사항이 저장되지 않았습니다. 계속 진행하시겠습니까?\n(마지막에 저장된 데이터를 기준으로 실행됩니다.)"},"Some pages have been modified but not saved. Do you wish to continue?":{ko:"일부 페이지들의 수정사항이 저장되지 않았습니다. 계속 진행하시겠습니까?\n(마지막에 저장된 데이터를 기준으로 실행됩니다.)"}};return this.convert=function(e){var a=this.locale,t=o[e];if(!t)return e;var i=t[a];return i||e},this};Oven.Translation=e});$(function(){var e=function(){this.encodeHtml=function(e){var t={"&":"&amp;","'":"&#39;",'"':"&quot;","<":"&lt;",">":"&gt;"},a=function(e){return t[e]||e};return e.replace(/[&<>]/g,a)},this.decodeHtml=function(e){var t={"&amp;":"&","&#39;":"'","&quot;":'"',"&lt;":"<","&gt;":">"},a=function(e){return t[e]||e};return e.replace(/&amp;|&lt;|&gt;/g,a)},this.makeThumbnail=function(e,t){var a,n=e.projectId,i=e.model,o=e.seqId,r=e.screenWidth,d=e.screenHeight,c=e.background,s=e.content,m=e.modidate,h=window.localStorage,l=n+":"+o,p=r,u=p*(1/3);u=u>326?326:u;var g=d,v=g*(1/3);v=v>1/3*500?1/3*500:v,e.thumbnail&&e.thumbnail.css({width:u/2,height:v/2});var f=u,w=v,I=h.getItem(l);if(!i.get("_thumbnail")&&I&&I.split("_data:image")[0]==m)return a={data:I.split(m+"_")[1],w:f,h:w,isNew:!1};var b=$(document.createElement("div")).attr("data-canvas","true").css({position:"absolute",top:0,overflow:"hidden",opacity:0,width:1,height:1}).addClass("canvas"),E=$(document.createElement("div")).width(p).height(g).css({overflow:"hidden",backgroundColor:c});E.html(s),E.find("[data-obj-type='image']").each(function(){var e=$(this);parseInt(e.css("left"))<0&&e.find("[data-image-content]").css("backgroundPositionX",parseInt(e.css("left"))),parseInt($(this).css("top"))<0&&e.find("[data-image-content]").css("backgroundPositionY",parseInt(e.css("top"))),e.find("[data-image-content]").css("backgroundSize",e.width()+"px "+e.height()+"px")}),b.append(E),$("body").append(b),html2canvas(E.get(0),{height:d,onrendered:function(e){var n=document.createElement("canvas");n.width=f,n.height=w;var i=n.getContext("2d");i.scale(1/3,1/3),i.drawImage(e,0,0,e.width,e.height),b.remove();var o=n.toDataURL("image/jpeg",.7);if(a={data:o,w:f,h:w,isNew:!0},"function"==typeof t)return t(a),!0}})},this.ajaxDownload=function(e){var t;if($.cookie("OVEN_PROCESSING_FILES"))return alert("요청하신 파일을 처리 중입니다. 처리가 완료되어 다운로드가 시작되면 다시 시도해주세요."),!1;t=$($("#processingFileTemplate").html()),$("body").append(t),window.checkProcessingInterval=setInterval(function(){if($.cookie("OVEN_PROCESSING_FILES"))return!1;t.remove(),clearInterval(window.checkProcessingInterval),delete window.checkProcessingInterval},100),$.cookie("OVEN_PROCESSING_FILES",!0,{path:"/"});var a;$("iframe[name='"+e.frameName+"']").length>0?a=$("iframe[name='"+e.frameName+"']"):(a=$(document.createElement("iframe")),a.attr({frameborder:0,name:e.frameName,style:"position:absolute;top:0;left:0;z-index:-1;overflow:hidden;width:1px;height:0px;"}),$("body").append(a));var n=$(document.createElement("form"));n.attr({action:e.url,method:e.method,target:e.frameName});for(var i in e.data)n.append("<input type='hidden' name='"+i+"' value=''>"),n.find("input[name='"+i+"']").val(e.data[i]);n.hide(),$("body").append(n),n.submit(),n.remove()},this.compressCanvas=function(e,t){var a=e.canvas,n=e.width,i=e.height,o=e.mimetype,r=new Image;r.width=n,r.height=i,r.src=a.toDataURL(o,.8),r.onload=function(){var e=document.createElement("canvas");e.width=n,e.height=i,e.getContext("2d").drawImage(r,0,0);var a=e.toDataURL(o);a=a.replace("data:"+o+";base64,",""),$(e).remove(),$(r).remove(),"function"==typeof t&&t(a)}}};Oven.Util=e});$(function(){var e=Backbone.Model.extend({idAttribute:"perm_id",defaults:{pro_id:"",user_name:"",user_email:"",perm_read:"Y",perm_modidate:"",perm_regidate:""}});Oven.Permission=Oven.Permission||{},Oven.Permission.Model=e});$(function(){var e=Oven.Permission.Model,n=Backbone.Collection.extend({model:e});Oven.Permission=Oven.Permission||{},Oven.Permission.Collection=n});$(function(){var e=Backbone.View.extend({tagName:"tr",events:{"click .send_invitation":"sendInvitation","click .btn_dismiss":"remove"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render"),this.template=_.template($("#confirmInvitationTemplate").html()),this.completeTemplate=_.template($("#confirmInvitationCompleteTemplate").html())},render:function(){return this.$el.html(this.template({user_email:this.user_email})),this},sendInvitation:function(){var e=this;$.ajax({url:"/api/sendShareInvitation",type:"POST",data:{perm_id:this.perm_id},success:function(){e.$el.html(e.completeTemplate({user_email:e.user_email}))}})},remove:function(){var e=this;this.$el.fadeOut(function(){e.$el.unbind().remove(),e.item.invitationMsg=void 0,delete e.item})}}),t=Backbone.View.extend({tagName:"tr",events:{"click .delete_user":"deleteUser","click .btn_perm":"permWriteClickHandler","click .show_invitation":"confirmInvitation"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render","destroyHandler","confirmInvitation"),this.template=_.template($("#projectPermissionItemTemplate").html()),this.model.item=this,this.model.on({"change:perm_id":this.render,destroy:this.destroyHandler,"change:perm_write":this.render})},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},confirmInvitation:function(){if(this.invitationMsg)return this.invitationMsg.$el.show(),!1;this.invitationMsg=new e({user_email:this.model.get("user_email"),perm_id:this.model.id,item:this}),this.$el.after(this.invitationMsg.render().$el)},deleteUser:function(){var e=this,t=loggedUser.email==this.model.get("user_email");if(t&&!confirm("유저 자신을 공유목록에서 삭제하면 더이상 프로젝트에 접근할 수 없게 됩니다. 계속하시겠습니까?"))return!1;this.model.destroy({dataType:"text",success:function(){if(t){var i=e.list.dialog.model;e.list.dialog.$el.modal("hide"),e.list.dialog.builder?window.opener?(window.opener.location.reload(),window.close()):location.href="/":permModel.collection&&(i.collection.remove(i),i.item.destroyHandler())}},error:function(t,i){403==i.status?alert("You don't have the permission."):alert("Cannot perform action due to an error."),e.list.dialog.$el.modal("hide")}}),void 0!==this.invitationMsg&&this.invitationMsg.remove()},destroyHandler:function(){this.$el.fadeOut(function(){this.remove()})},permWriteClickHandler:function(e){var t=$(e.currentTarget).find("input").get(0).checked,i=!t;this.model.save({perm_write:!0===i?"Y":"N"},{patch:!0})}});Oven.Permission=Oven.Permission||{},Oven.Permission.Item=t});$(function(){var e=Oven.Translation,i=Oven.Permission.Collection,t=Oven.Permission.Item,n=Backbone.View.extend({events:{"keydown .add_user_input":"addUserKeydownHadnler","click .add_user":"addUserClickHandler"},initialize:function(t){_.extend(this,t),_.bindAll(this,"render","appendItem","addItem","validateEmail"),this.formEl=$($("#projectPermissionFormTemplate").html()),this.translation=new e({locale:loggedUser.locale}),this.collection=new i,this.collection.url=this.permissionUrl,this.collection.on({reset:this.render,add:this.addItem}),this.collection.fetch({reset:!0})},render:function(){this.$el.find(".permission_form").append(this.formEl),this.collection.each(this.appendItem)},appendItem:function(e){var i=new t({model:e,list:this});this.$el.find("tbody").append(i.render().el)},addItem:function(e){this.appendItem(e),this.$el.find(".permission_wrapper").stop().animate({scrollTop:this.$el.find(".permission_wrapper").scrollTop()+e.item.$el.position().top}),this.confirmInvitation(e)},confirmInvitation:function(e){e.item.confirmInvitation()},validateEmail:function(e){var i;if(/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e))if(this.collection.where({user_email:e}).length>0)i=this.translation.convert("Already exists in the list.");else{if(e!=loggedUser.email)return!0;i=this.translation.convert("You cannot add yourself.")}else i=this.translation.convert("Email address is invalid.");var t=this.formEl.find("input");return t.popover({content:i,placement:"bottom"}),t.popover("show"),t.focus(),!1},addUserClickHandler:function(){var e=this,i=$.trim(this.formEl.find("input").val());if(!1===this.validateEmail(i))return!1;var t={user_email:i};this.collection.create(t,{success:function(){e.formEl.find("input").val("")},wait:!0})},addUserKeydownHadnler:function(e){13==e.which?this.addUserClickHandler():this.formEl.find("input").popover("destroy")}});Oven.Permission=Oven.Permission||{},Oven.Permission.List=n});$(function(){var e=Backbone.View.extend({events:{},initialize:function(e){_.extend(this,e),_.bindAll(this,"render"),this.template=_.template($("#qrDialogTemplate").html()),this.render()},render:function(){var e=this,t={qrUrl:"/api/qr?pro="+this.pro_id+(this.seq_id?"&seq="+this.seq_id:""),shortUrl:location.origin+this.url};""==this.$el.html()?this.$el=$(this.template(t)):this.$el.html($(this.template(t)).html()),this.delegateEvents(),e.$el.modal("show")}});Oven.Dialog=Oven.Dialog||{},Oven.Dialog.QR=e});$(function(){var e=Backbone.View.extend({events:{"click .go_webview":"webviewClickHandler"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render","webviewClickHandler"),this.template=_.template($("#browserWarningDialogTemplate").html()),this.render()},render:function(){""==this.$el.html()?this.$el=$(this.template()):this.$el.html($(this.template()).html()),this.delegateEvents(),this.$el.modal("show")},webviewClickHandler:function(){this.model.item.webviewSequence(),this.$el.modal("hide")}});Oven.Dialog=Oven.Dialog||{},Oven.Dialog.Browser=e});$(function(){var e=Backbone.Model.extend({idAttribute:"pro_id",urlRoot:"/api/projects/",initialize:function(e){_.extend(this,e)},defaults:{pro_title:"",pro_description:"",pro_screen:0,pro_editortype:0,pro_public_read:"N",pro_modidate:"",pro_regidate:"",user_id:"",user_email:"",user_profile:"",user_name:"",perm_read:"",perm_write:"",shared_count:0,_isChecked:!1,_isSharedProject:0}}),r=e.extend({initialize:function(){this.urlRoot=0==this.get("_isSharedProject")?"/api/projects":"/api/sharedProjects"}});Oven.Project=Oven.Project||{},Oven.Project.Model=e,Oven.Project.SearchModel=r});$(function(){var e=Oven.Project.Model,o=Oven.Project.SearchModel,c=Backbone.Collection.extend({model:e,url:"/api/projects"}),n=Backbone.Collection.extend({model:e,url:"/api/sharedProjects"}),l=Backbone.Collection.extend({model:o,url:"/api/projects/_search"});Oven.Project=Oven.Project||{},Oven.Project.Collection=c,Oven.Project.SharedCollection=n,Oven.Project.SearchCollection=l});$(function(){var e=new Oven.Util,t=Backbone.View.extend({events:{click:"clickHandler","click .project_link":"linkClickHandler","click .popover":"stopPropagation","click input[type='checkbox']":"checkClickHandler","click .modify_this_project":"modifyProject","click .project_permission":"configPermission","click .delete_this_project":"deleteProject","click .cp_this_project":"copyProject","click .cencel_delete_this":"hideDeletePopup","click .confirm_delete_this":"confirmDelete","click .project-dropdown":"dropDownClickHandler","click .webview_project":"webviewSequence","click .webview_qr":"qrClickHandler","mouseenter .shared_list[data-toggle='tooltip']":"getSharedList"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render","checkClickHandler","checkedChangeHandler","saveThumbnail","destroyHandler","drawThumbnail","getWebviewURL","webviewSequence","getSharedList"),this.model.on({"change:_isChecked":this.checkedChangeHandler,patch:this.render,destroy:this.destroyHandler}),this.model.item=this},render:function(){return"media"==this.list.viewType?(this.template=_.template($("#dashboard_project_item_media").html()),this.$el.attr("class","item media list-group-item clearfix")):"card"==this.list.viewType&&(this.template=_.template($("#dashboard_project_item_card").html()),this.$el.attr("class","item col-sm-6 col-md-4")),this.$el.html(this.template(this.model.toJSON())),this.$el.find(".public_read[data-toggle='tooltip']").tooltip(),this.getThumbnail(),this.checkedChangeHandler(),this.$el.find(".confirm_delete_this").popover({html:!0,title:this.list.translation.convert("Delete this item?"),placement:"media"==this.list.viewType?"left":"bottom",content:"media"==this.list.viewType?"<button type='button' class='btn btn-danger delete_this_project'>"+this.list.translation.convert("Delete")+"</button>&nbsp;&nbsp;<button type='button' class='btn btn-default cencel_delete_this'>"+this.list.translation.convert("Cancel")+"</button>":"<button type='button' class='btn btn-danger btn-block delete_this_project'>"+this.list.translation.convert("Delete")+"</button><button type='button' class='btn btn-default  btn-block cencel_delete_this'>"+this.list.translation.convert("Cancel")+"</button>"}),this},getSharedList:function(){var e=this,t=e.$el.find(".shared_list[data-toggle='tooltip']");t.attr("data-original-title")?t.tooltip("show"):$.ajax({url:"/api/projects/"+this.model.id+"/sharedUsers",type:"GET",success:function(e){var i=_.pluck(e,"user_email");t.attr("title",i.length?i.join("<br>"):"None"),t.tooltip({html:!0}).tooltip("show")}})},getThumbnail:function(){var t=e.makeThumbnail({projectId:this.model.id,seqId:this.model.get("seq_id"),model:this.model,screenWidth:this.model.get("seq_screen_width")||this.model.get("pro_screen"),screenHeight:700,background:this.model.get("seq_background")||"#fff",content:this.model.get("seq_content"),modidate:this.model.get("seq_modidate")},this.drawThumbnail);t&&t.data&&this.drawThumbnail(t)},drawThumbnail:function(e){this.$el.find(".sequence_thumbnail img").css({backgroundImage:"url("+e.data+")"}),e.isNew&&this.model.get("seq_id")&&this.saveThumbnail(e.data)},saveThumbnail:function(e){var t=this.model.id+":"+this.model.get("seq_id");try{window.localStorage.setItem(t,this.model.get("seq_modidate")+"_"+e)}catch(e){window.localStorage.clear()}},checkClickHandler:function(){var e=this.$el.find("input[type='checkbox']").get(0).checked;this.model.set({_isChecked:e})},checkedChangeHandler:function(){if(this.model.get("_isSharedProject"))return!1;var e=this.model.get("_isChecked");this.$el.find("input[type='checkbox']").get(0).checked=e,"media"==this.list.viewType?this.$el.toggleClass("list-group-item-info",e):"card"==this.list.viewType&&this.$el.find("> .thumbnail").toggleClass("alert-info",e),this.list.toggleMoreMenu()},destroyHandler:function(){var e=this;this.$el.fadeOut(function(){e.list.toggleMoreMenu(),e.list.toggleNoProject(),this.remove()})},modifyProject:function(){this.list.showProjectModifyDialog(this.model)},configPermission:function(){this.list.showPermissionDialog(this.model)},deleteProject:function(){this.model.destroy()},copyProject:function(){this.model.get("_isSharedProject")&&this.list.myProjectClickHandler();var e=this,t=this.model.clone();this.list.collection.create(t,{wait:!0,silent:!0,success:function(t){t.set({pro_title:("Copy of "+t.get("pro_title")).substring(0,255),pro_regidate:new Date,pro_modidate:new Date,_isChecked:!1,_isSharedProject:0}),e.list.collection.trigger("copy",t)}})},confirmDelete:function(){return!1},hideDeletePopup:function(){this.$el.find(".confirm_delete_this").popover("hide")},stopPropagation:function(e){e.stopPropagation()},clickHandler:function(){this.hideDeletePopup()},dropDownClickHandler:function(){void 0!==this.list.clickedProject&&this.list.clickedProject.$el.css("zIndex",""),this.list.clickedProject=this,this.list.clickedProject.$el.css("zIndex",10)},linkClickHandler:function(e){if(!1===this.list.filterBrowser(this.model))return!1;this.model.get("_isSharedProject")&&(e.preventDefault(),this.webviewSequence())},getWebviewURL:function(){return"/view/"+this.model.id+"/"},webviewSequence:function(){var e=this.model.get("seq_screen_width")||this.model.get("pro_screen"),t=640!=e||this.model.get("seq_screen_height")?this.model.get("seq_screen_height")||600:360;window.open(this.getWebviewURL(),"_blank","resizable=yes, width="+e+", height="+t)},qrClickHandler:function(){this.list.showWebviewQRDialog(this.model)}});Oven.Project=Oven.Project||{},Oven.Project.Item=t});$(function(){var t=new Oven.Util,i=Backbone.View.extend({events:{"keydown input":"keydownHandler","focus input":"focusHandler","blur input":"blurHandler"},initialize:function(t){_.extend(this,t),_.bindAll(this,"keydownHandler"),this.isTyping=!1,this.typingTimer=void 0,this.watchIntv=void 0,this.currentKeyword=void 0},keydownHandler:function(){var t=this;if(this.isTyping)return clearTimeout(this.typingTimer),this.typingTimer=setTimeout(function(){t.isTyping=!1},300),!0;this.isTyping=!0,this.typingTimer=setTimeout(function(){clearTimeout(this.typingTimer),t.isTyping=!1},300)},focusHandler:function(){this.startWatch()},blurHandler:function(){this.stopWatch()},startWatch:function(){var i=this;this.watchIntv=setInterval(function(){if(i.isTyping)return!1;var n=t.encodeHtml($.trim(i.$el.find("input").val()));return i.currentKeyword&&n.length<1&&i.currentKeyword.length>0?(i.stopWatch(),i.$el.find("input").blur(),i.list.resetList(),i.currentKeyword=void 0,i.$el.find("input").focus(),!1):!(i.currentKeyword==n||n.length<1)&&(i.currentKeyword=n,void i.list.searchCollection.fetch({data:{q:i.currentKeyword},reset:!0}))},300)},stopWatch:function(){clearInterval(this.watchIntv)}});Oven.Project=Oven.Project||{},Oven.Project.Search=i});$(function(){var e=Oven.Permission.List,t=Backbone.View.extend({events:{"click .btn_pro_public":"proPublicClickHandler","hide.bs.modal":"modalHideHandler","submit .read_pass_form":"readPassFormSubmitHandler","shown.bs.popover .public_read_password":"getReadPass"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render","proPublicClickHandler","modalHideHandler","readPassFormSubmitHandler","getReadPass"),this.template=_.template($("#dashboard_project_modal_permission").html()),this.render()},render:function(){""==this.$el.html()?this.$el=$(this.template(this.model.toJSON())):this.$el.html($(this.template(this.model.toJSON())).html()),this.getReadPass(!0);var t=new e({$el:this.$el,permissionUrl:this.model.url()+"/permission",dialog:this});this.permissionList=t,this.$el.find(".public_read_password").popover({html:!0,title:"공유 암호 설정",placement:"bottom",container:"#permissionModal",content:_.template($("#publicReadPasswordFormTemplate").html())}),this.delegateEvents(),this.$el.modal("show")},proPublicClickHandler:function(e){var t=$(e.currentTarget).find("input").attr("name"),s=$(e.currentTarget).find("input").get(0).checked,i=!s;$(e.currentTarget).toggleClass("btn-info",i),this.$el.find("input[name='"+t+"']").get(0).checked=i;var a=this.$el.find("input[name='pro_public_read']:checked").val()||"N";this.model.save({pro_public_read:a},{patch:!0}),this.$el.find(".public_read_password").toggle("Y"==a).popover("hide").removeClass("active")},modalHideHandler:function(){if(this.model.item){this.$el.find(".public_read_password").popover("hide");var e=this.model.item;this.model.set("shared_count",this.permissionList.collection.length),e.$el.find(".shared_list[data-toggle='tooltip']").tooltip("destroy"),e.render()}},getReadPass:function(e){var t=this;$.ajax({url:this.model.url()+"/publicReadPassword",type:"GET",success:function(s){!0===e&&s.pass?t.$el.find(".public_read_password").addClass("btn-success"):s.pass?t.$el.find("input[name='read_pass']").val(s.pass):t.$el.find("input[name='read_pass']").attr("placeholder","공유 암호를 입력하세요")}})},readPassFormSubmitHandler:function(e){e.preventDefault();var t=this.$el.find(".public_read_password"),s=this.$el.find("input[name='read_pass']"),i=$.trim(s.val()),a=/^(?=.*[a-zA-z])(?=.*[0-9])(?=.*[$`~!@$!%*#^?&\\\\(\\\\)\\-_=+]).{8,32}$/;return i.length&&!a.test(i)?(alert("8~32자의 영문 대/소문자,숫자,특수문자로 입력해주세요."),s.focus(),!1):($.ajax({url:this.model.url()+"/publicReadPassword",type:"POST",data:{read_pass:i},success:function(e){t.popover("hide"),i.length?t.addClass("btn-success"):t.removeClass("btn-success"),t.removeClass("active")}}),!1)}});Oven.Project=Oven.Project||{},Oven.Project.PermissionDialog=t});$(function(){var e=new Oven.Util,t=Backbone.View.extend({events:{"click .save_modify":"saveProject","click .device_select label":"deviceClickHandler"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render"),this.template=_.template($("#dashboard_project_modal_modify").html()),this.render()},render:function(){if(""==this.$el.html()?this.$el=$(this.template(this.model.toJSON())):this.$el.html($(this.template(this.model.toJSON())).html()),this.delegateEvents(),void 0!==this.startTabSelector){var e=this.$el.find(this.startTabSelector);e.tab("show"),this.$el.find(".tab-pane.in.active").removeClass("active in"),this.$el.find(e.attr("href")).addClass("active in"),this.startTabSelector=void 0}this.$el.modal("show")},validateCurrentStep:function(){var e=this.$el.find("input:required");if(e.length<1)return!0;for(var t=0;t<e.length;t++){if($.trim($(e[t]).val()).length<1)return $(e[t]).popover({content:e[t].getAttribute("placeholder"),placement:"bottom"}),$(e[t]).popover("show"),e[t].focus(),!1}return!0},saveProject:function(){if(this.model.get("_isSharedProject"))return!1;if(!this.validateCurrentStep())return!1;var t=this,i=this.$el.find("form");this.model.save({pro_title:e.encodeHtml($.trim(i.find("input[name='pro_title']").val())),pro_description:e.encodeHtml($.trim(i.find("textarea[name='pro_description']").val())),pro_screen:i.find("input[name='pro_screen']:checked").val(),pro_editortype:i.find("input[name='pro_editortype']:checked").val(),pro_public_read:i.find("input[name='pro_public_read']:checked").val()||"N"},{success:function(e){t.$el.modal("hide"),e.trigger("patch")},patch:!0})},deviceClickHandler:function(e){this.$el.find(".device_select .btn-info").removeClass("btn-info"),$(e.currentTarget).addClass("btn-info")}});Oven.Project=Oven.Project||{},Oven.Project.ModifyDialog=t});$(function(){var e=new Oven.Util,i=(Oven.Project.Model,Backbone.View.extend({events:{"click .submit_new_project":"submitNewProject","click .device_select label":"deviceClickHandler","click .public_read_y":"publicYesClickHandler","click .public_read_n":"publicNoClickHandler"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render"),this.$el=$($("#dashboard_project_modal").html()),this.render()},render:function(){this.$el.find("form").get(0).reset(),this.delegateEvents(),this.$el.find('[data-toggle="tooltip"]').tooltip(),this.$el.modal("show")},submitNewProject:function(){var i=this,t=this.$el.find("form");if($.trim(t.find("input[name='pro_title']").val()).length<1)return t.find("input[name='pro_title']").focus(),!1;this.list.collection.create({pro_title:e.encodeHtml($.trim(t.find("input[name='pro_title']").val())),pro_description:e.encodeHtml($.trim(t.find("textarea[name='pro_description']").val())),pro_public_read:"Y"===t.find("input[name='pro_public_read']:checked").val()?"Y":"N",pro_screen:t.find("input[name='pro_screen']:checked").val(),pro_editortype:t.find("input[name='pro_editortype']:checked").val()},{wait:!0,silent:!0,success:function(e){i.$el.modal("hide"),i.list.collection.trigger("create",e)}})},publicYesClickHandler:function(){this.$el.find(".public_read_y").addClass("btn-info"),this.$el.find(".public_read_n").removeClass("btn-info"),this.$el.find(".public_yes_msg").show(),this.$el.find(".public_no_msg").hide()},publicNoClickHandler:function(){this.$el.find(".public_read_y").removeClass("btn-info"),this.$el.find(".public_read_n").addClass("btn-info"),this.$el.find(".public_yes_msg").hide(),this.$el.find(".public_no_msg").show()},deviceClickHandler:function(e){this.$el.find(".device_select .btn-info").removeClass("btn-info"),$(e.currentTarget).addClass("btn-info")}}));Oven.Project=Oven.Project||{},Oven.Project.CreateDialog=i});$(function(){var e=Oven.Translation,t=Oven.Project.Collection,i=Oven.Project.SharedCollection,o=Oven.Project.SearchCollection,s=Oven.Project.Item,l=Oven.Project.Search,n=Oven.Project.CreateDialog,r=Oven.Project.PermissionDialog,c=Oven.Project.ModifyDialog,h=Oven.Dialog.QR,a=Oven.Dialog.Browser,d=Backbone.View.extend({events:{click:"clickHandler","click .more_menu":"stopPropagation","click .new_project":"showProjectCreateDialog","click .delete_project":"deleteProject","click .cencel_delete":"hideDeletePopup","click .change_viewtype":"changeViewType","click .select_all":"selectAllProject","click .back_to_list":"goBackTolist","click .keyword_notice .close":"resetList","click #loadMyProject":"myProjectClickHandler","click #loadSharedProject":"sharedProjectClickHandler"},initialize:function(s){_.extend(this,s),_.bindAll(this,"render","appendItem","changeViewType","selectAllProject","clickHandler","toggleNoProject","resizeHandler","prependItem","prependCopiedItem","spyScroll","showProjectModifyDialog","renderSearchResult","resetList","toggleMoreMenu","showWebviewQRDialog","filterBrowser"),this.template=_.template($("#dashboard_project_list").html()),this.pageNumber=1,this.isLoading=!1,this.translation=this.translation||new e({locale:loggedUser.locale}),this.sharedCollection=new i,this.sharedCollection.on({reset:this.render,add:this.appendItem}),this.searchCollection=new o,this.searchCollection.isListed=!1,this.searchCollection.on({reset:this.renderSearchResult,copy:this.prependCopiedItem}),this.myCollection=new t,this.myCollection.on({reset:this.render,add:this.appendItem,create:this.prependItem,copy:this.prependCopiedItem}),this.myCollection.fetch({reset:!0,data:{page:this.pageNumber}}),this.collection=this.myCollection},render:function(){this.$el.html(this.template({viewType:this.viewType,_isSharedProject:this.collection==this.sharedCollection})),this.collection.each(this.appendItem),this.toggleNoProject(),this.$el.find(".select_all").toggleClass("disabled",this.collection==this.sharedCollection),this.$el.find(".new_project").toggle(this.collection==this.myCollection),this.$el.find(".search_project input").val(""),this.$el.find(".keyword_notice").hide(),this.effectUI()},toggleNoProject:function(){if(this.collection.length<1){var e=this;this.$el.find(".project-list .no_data").length<1&&e.$el.find(".project-list").append($("#errorType1Template").html())}else this.$el.find(".project-list .no_data").remove()},effectUI:function(){this.searchApp=new l({$el:this.$el.find(".search_project"),list:this}),this.resizeHandler(),$(window).off("resize").on("resize",this.resizeHandler),this.$el.find(".project-list-wrapper").off("scroll").on("scroll",this.spyScroll),void 0!==this.spyIntv&&clearInterval(this.spyIntv),this.spyIntv=setInterval(this.spyScroll,250),this.$el.find(".confirm_delete").popover("destroy").popover({html:!0,title:this.translation.convert("Delete selected items?"),placement:"right",container:"#projects",content:"<button type='button' class='btn btn-block btn-danger delete_project'>"+this.translation.convert("Delete")+"</button><button type='button' class='btn btn-block btn-default cencel_delete'>"+this.translation.convert("Cancel")+"</button>"})},resizeHandler:function(){this.$el.find(".project-list-wrapper").css({height:$(window).outerHeight()-this.$el.find(".project-list-wrapper").offset().top-85})},appendItem:function(e,t,i){var o=new s({model:e,list:this});if(-1===t){var l=this,n=o.render().$el;this.$el.find(".project-list-wrapper").animate({scrollTop:0},100),setTimeout(function(){n.addClass("pop"),l.$el.find(".project-list").prepend(n),setTimeout(function(){n.removeClass("pop")},10)},300)}else this.$el.find(".project-list").append(o.render().$el)},prependItem:function(e){this.appendItem(e,-1),this.toggleNoProject()},prependCopiedItem:function(e){this.appendItem(e,-1,!0)},showProjectCreateDialog:function(){this.projectDialog?this.projectDialog.initialize():this.projectDialog=new n({list:this})},showProjectModifyDialog:function(e){this.projectModifyDialog?this.projectModifyDialog.initialize({model:e}):this.projectModifyDialog=new c({list:this,model:e})},showPermissionDialog:function(e){this.projectPermissionDialog?this.projectPermissionDialog.initialize({model:e}):this.projectPermissionDialog=new r({list:this,model:e})},deleteProject:function(){(this.searchCollection.isListed?this.searchCollection:this.collection).where({_isChecked:!0,_isSharedProject:0}).forEach(function(e){e.destroy()}),this.hideDeletePopup()},hideDeletePopup:function(){this.$el.find(".confirm_delete").popover("hide")},toggleMoreMenu:function(){var e=this.searchCollection.isListed?this.searchCollection:this.collection,t=e.where({_isChecked:!0}).length;this.$el.find(".more_menu .count").html(t+" item"+(t>1?"s":"")),this.$el.find(".more_menu").toggle(t>0)},selectAllProject:function(){var e=this.searchCollection.isListed?this.searchCollection:this.collection;e.where({_isChecked:!1,_isSharedProject:0}).length<1?e.where({_isChecked:!0,_isSharedProject:0}).forEach(function(e){e.set("_isChecked",!1)}):e.where({_isChecked:!1,_isSharedProject:0}).forEach(function(e){e.set("_isChecked",!0)})},changeViewType:function(e){this.viewType=$(e.currentTarget).find("> input").val(),$.cookie("OVEN_DASHBOARD_VIEWTYPE",this.viewType,{expires:30}),this.collection.each(function(e){e.item.render()})},fetchMoreList:function(){if(this.isLoading)return!1;var e=this;this.isLoading=!0,this.collection.fetch({update:!0,remove:!1,data:{page:this.pageNumber+1},success:function(t,i){if(!i.length)return clearInterval(e.spyIntv),e.$el.find(".project-list-wrapper").off("scroll"),e.$el.find(".loading").hide(),e.isLoading=!1,!1;e.pageNumber++,setTimeout(function(){e.isLoading=!1},1e3)}})},spyScroll:function(){var e=this.$el.find(".project-list"),t=this.$el.find(".project-list-wrapper");e.position().top+e.outerHeight()-t.height()<300&&this.fetchMoreList()},clickHandler:function(){this.hideDeletePopup()},stopPropagation:function(e){e.stopPropagation()},renderSearchResult:function(){this.toggleMoreMenu(),this.$el.find(".project-list").html(""),this.searchCollection.each(this.appendItem),this.$el.find(".keyword_notice .keyword").html(this.searchApp.currentKeyword),this.$el.find(".keyword_notice .count").html(this.searchCollection.length),this.$el.find(".keyword_notice").show(),this.$el.find(".new_project").hide(),this.$el.find(".select_all").removeClass("disabled"),this.searchCollection.isListed=!0},resetList:function(){this.pageNumber=1,this.collection.fetch({data:{page:this.pageNumber},reset:!0}),this.$el.find(".select_all").toggleClass("disabled",this.collection==this.sharedCollection),this.searchCollection.isListed=!1,this.toggleMoreMenu()},myProjectClickHandler:function(){return this.collection==this.myProjectClickHandler||(this.collection=this.myCollection,this.searchCollection.isListed?(this.resetList(),!0):(this.pageNumber=1,void this.collection.fetch({reset:!0,data:{page:this.pageNumber}})))},sharedProjectClickHandler:function(){return this.collection==this.sharedCollection||(this.collection=this.sharedCollection,this.searchCollection.isListed?(this.resetList(),!0):(this.pageNumber=1,void this.collection.fetch({reset:!0,data:{page:this.pageNumber}})))},showWebviewQRDialog:function(e){var t={url:e.item.getWebviewURL(),pro_id:e.id};this.qrDialog?this.qrDialog.initialize(t):this.qrDialog=new h(t)},filterBrowser:function(e){var t=["chrome","firefox","opera","safari","edge"],i=["ios","android"],o=this.ua.browser.name.toLowerCase(),s=this.ua.os.name.toLowerCase();return t.indexOf(o)>-1&&i.indexOf(s)<0||(this.browserDialog?this.browserDialog.initialize({model:e}):this.browserDialog=new a({model:e}),!1)}});Oven.Project=Oven.Project||{},Oven.Project.List=d});